<?xml version="1.0" encoding="UTF-8"?>
<!--
  ACB Link Desktop - WiX MSI Installer Source
  Creates a Windows Installer (MSI) package

  Build with:
    heat.exe dir "dist\ACBLink" -cg ProductComponents -dr INSTALLDIR -gg -scom -sreg -sfrag -srd -var var.SourceDir -out files.wxs
    candle.exe -dSourceDir="dist\ACBLink" -dVersion="1.0.0" acb_link.wxs files.wxs
    light.exe -ext WixUIExtension acb_link.wixobj files.wixobj -out ACBLink-1.0.0.msi
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?define ProductName = "ACB Link Desktop" ?>
  <?define Manufacturer = "American Council of the Blind" ?>
  <?define UpgradeCode = "8E7B5A3D-4F2C-4E1A-9B8D-6C5A7E9F2D1B" ?>

  <Product Id="*"
           Name="$(var.ProductName)"
           Language="1033"
           Version="$(var.Version)"
           Manufacturer="$(var.Manufacturer)"
           UpgradeCode="$(var.UpgradeCode)">

    <Package InstallerVersion="500"
             Compressed="yes"
             InstallScope="perMachine"
             Description="$(var.ProductName) - Your gateway to ACB media content"
             Comments="Accessible audio streaming application for the American Council of the Blind"
             Platform="x64" />

    <!-- Upgrade handling -->
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <!-- Embed cab file in MSI -->
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <!-- Installation directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLDIR" Name="ACB Link Desktop">
          <!-- Files come from files.wxs generated by heat.exe -->
        </Directory>
      </Directory>

      <!-- Start Menu shortcuts -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="ACB Link Desktop"/>
      </Directory>

      <!-- Desktop shortcut -->
      <Directory Id="DesktopFolder" Name="Desktop"/>
    </Directory>

    <!-- Shortcuts -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="A1B2C3D4-E5F6-7890-ABCD-EF1234567890">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="$(var.ProductName)"
                  Description="Your gateway to ACB media content"
                  Target="[INSTALLDIR]ACBLink.exe"
                  WorkingDirectory="INSTALLDIR"/>
        <Shortcut Id="UserGuideShortcut"
                  Name="User Guide"
                  Description="ACB Link Desktop User Guide"
                  Target="[INSTALLDIR]docs\USER_GUIDE.md"/>
        <Shortcut Id="UninstallShortcut"
                  Name="Uninstall $(var.ProductName)"
                  Target="[SystemFolder]msiexec.exe"
                  Arguments="/x [ProductCode]"/>
        <RemoveFolder Id="RemoveApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)"
                       Name="StartMenuShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="DesktopFolder">
      <Component Id="DesktopShortcut" Guid="B2C3D4E5-F6A7-8901-BCDE-F23456789012">
        <Shortcut Id="DesktopShortcutLink"
                  Name="$(var.ProductName)"
                  Description="Your gateway to ACB media content"
                  Target="[INSTALLDIR]ACBLink.exe"
                  WorkingDirectory="INSTALLDIR"/>
        <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)"
                       Name="DesktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- Feature definition -->
    <Feature Id="ProductFeature" Title="$(var.ProductName)" Level="1">
      <ComponentGroupRef Id="ProductComponents"/>
      <ComponentRef Id="ApplicationShortcut"/>
      <ComponentRef Id="DesktopShortcut"/>
    </Feature>

    <!-- UI -->
    <UIRef Id="WixUI_InstallDir"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"/>

    <!-- License -->
    <WixVariable Id="WixUILicenseRtf" Value="LICENSE.rtf"/>

    <!-- Icon for Add/Remove Programs -->
    <Icon Id="ProductIcon" SourceFile="$(var.SourceDir)\ACBLink.exe"/>
    <Property Id="ARPPRODUCTICON" Value="ProductIcon"/>
    <Property Id="ARPHELPLINK" Value="https://acb.org"/>
    <Property Id="ARPURLINFOABOUT" Value="https://acb.org"/>

  </Product>
</Wix>
